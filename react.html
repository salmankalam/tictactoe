<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- <script src="https://unpkg.com/react-scripts@5.0.0/"></script> -->

    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      // Square component for each cell of the board
      function Square({ value, onSquareClick, isDarkMode }) {
        const textColorClass = value === 'X' ? 'text-purple-600' : value === 'O' ? 'text-teal-400' : isDarkMode ? 'text-gray-200' : 'text-gray-800';
        const bgColorClass = isDarkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-white hover:bg-gray-100';
        const borderColorClass = isDarkMode ? 'border-gray-500' : 'border-gray-400';

        return (
          <button
            className={`${bgColorClass} border ${borderColorClass} w-16 h-16 sm:w-20 sm:h-20 text-3xl font-bold rounded-lg shadow-md transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 ${textColorClass}`}
            onClick={onSquareClick}
          >
            {value}
          </button>
        );
      }

      // Board component that renders the 3x3 grid
      function Board({ xIsNext, squares, onPlay, isDarkMode }) {
        // Function to handle a square click
        function handleClick(i) {
          // If a square is already filled or the game is won, do nothing.
          if (squares[i] || calculateWinner(squares)) {
            return;
          }

          // Create a new array to represent the next state of the board.
          const nextSquares = squares.slice();
          if (xIsNext) {
            nextSquares[i] = "X";
          } else {
            nextSquares[i] = "O";
          }
          // Call the parent's `onPlay` function with the new board state.
          onPlay(nextSquares);
        }

        // Determine the winner or the next player's turn.
        const winner = calculateWinner(squares);
        let status;
        let statusColorClass;
        const defaultTextColorClass = isDarkMode ? 'text-gray-200' : 'text-gray-800';

        if (winner) {
          status = "Winner: " + winner;
          statusColorClass =
            winner === "X" ? "text-purple-600" : "text-teal-600";
        } else if (!squares.includes(null)) {
          status = "Draw!";
          statusColorClass = defaultTextColorClass;
        } else {
          status = "Next player: " + (xIsNext ? "X" : "O");
          statusColorClass = xIsNext ? "text-purple-600" : "text-teal-600";
        }

        // Render the game board and status.
        return (
          <>
            <div
              className={`mb-6 text-2xl font-bold text-center ${statusColorClass}`}
            >
              {status}
            </div>
            <div className="grid grid-cols-3 gap-3">
              {/*
                We use a map to dynamically render all 9 squares, making the code cleaner
                and more scalable.
            */}
              {squares.map((squareValue, i) => (
                <Square
                  key={i}
                  value={squareValue}
                  onSquareClick={() => handleClick(i)}
                  isDarkMode={isDarkMode}
                />
              ))}
            </div>
          </>
        );
      }

      // Main Game component that manages the game state and history
      function Game() {
        // Use React's React.useState hook to manage the game history and current move.
        const [history, setHistory] = React.useState([Array(9).fill(null)]);
        const [currentMove, setCurrentMove] = React.useState(0);
        const xIsNext = currentMove % 2 === 0;
        const currentSquares = history[currentMove];
        const [isDarkMode, setIsDarkMode] = React.useState(false);

        // Function to handle a new move being played and update the history.
        function handlePlay(nextSquares) {
          const nextHistory = [
            ...history.slice(0, currentMove + 1),
            nextSquares,
          ];
          setHistory(nextHistory);
          setCurrentMove(nextHistory.length - 1);
        }

        // Function to jump to a specific move in the history.
        function jumpTo(nextMove) {
          setCurrentMove(nextMove);
        }

        function toggleDarkMode() {
          setIsDarkMode(!isDarkMode);
        }

        // Generate the list of moves for the history display.
        const moves = history.map((squares, move) => {
          let description;
          if (move > 0) {
            description = "Go to move #" + move;
          } else {
            description = "Go to game start";
          }
          
          return (
            <li key={move} className="py-1">
              {move === currentMove ? (
                <p className="font-bold text-lg text-yellow-500">
                  You are at move: {move}
                </p>
              ) : (
                <button
                  className="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-xl shadow-md transition-colors duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2"
                  onClick={() => jumpTo(move)}
                >
                  {description}
                </button>
              )}
            </li>
          );
        });

        const mainBgClass = isDarkMode
          ? "bg-gray-900 text-gray-200"
          : "bg-green-300 text-gray-800";
        const cardBgClass = isDarkMode ? "bg-gray-800" : "bg-white";
        const cardBorderClass = isDarkMode
          ? "border-gray-700"
          : "border-gray-200";
        const cardShadowClass = isDarkMode ? "shadow-xl" : "shadow-2xl";

        // Render the main game layout.
        return (
          <div className={`flex flex-col lg:flex-row justify-center items-center h-screen p-6 font-inter ${mainBgClass}`}>
            <button
              onClick={toggleDarkMode}
              className="absolute top-4 right-4 p-2 rounded-full text-white bg-gray-500 hover:bg-gray-600 transition-colors duration-300"
              title="Toggle Dark Mode"
            >
              {isDarkMode ? (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  className="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth={2}
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                  />
                </svg>
              ) : (
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  className="h-6 w-6"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    strokeWidth={2}
                    d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                  />
                </svg>
              )}
            </button>

            {/* Game board section with a modern, card-like design */}
            <div
              className={`game-board p-8 ${cardBgClass} rounded-xl ${cardShadowClass} mb-8 lg:mb-0 lg:mr-10 border ${cardBorderClass}`}
            >
              <Board
                xIsNext={xIsNext}
                squares={currentSquares}
                onPlay={handlePlay}
                isDarkMode={isDarkMode}
              />
            </div>
            {/* Game info/history section with a clean, scrollable design */}
            <div
              className={`game-info p-8 ${cardBgClass} rounded-xl ${cardShadowClass} overflow-y-auto max-h-96 w-full lg:w-96 border ${cardBorderClass}`}
            >
              <h2
                className={`text-2xl font-bold mb-4 ${
                  isDarkMode ? "text-gray-200" : "text-gray-800"
                }`}
              >
                Game History
              </h2>
              <ol className="list-none p-0 space-y-3">{moves}</ol>
            </div>
          </div>
        );
      }

      // Helper function to determine the winner
      function calculateWinner(squares) {
        const lines = [
          [0, 1, 2],
          [3, 4, 5],
          [6, 7, 8],
          [0, 3, 6],
          [1, 4, 7],
          [2, 5, 8],
          [0, 4, 8],
          [2, 4, 6],
        ];
        for (let i = 0; i < lines.length; i++) {
          const [a, b, c] = lines[i];
          if (
            squares[a] &&
            squares[a] === squares[b] &&
            squares[a] === squares[c]
          ) {
            return squares[a];
          }
        }
        return null;
      }

      const container = document.getElementById("root");
      const root = ReactDOM.createRoot(container);
      root.render(<Game />);
    </script>
  </body>
</html>
